<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cascade: Associations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Cascade
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_api__docs_2using__cascade_2associations_2associations.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Associations</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md5"></a> </p><blockquote class="doxtable">
<p>&zwj;“The programmer, like the poet, works only slightly removed from pure thought-stuff. He builds his castles in the air, from air, creating by exertion of the imagination. Few media of creation are so flexible, so easy to polish and rework, so readily capable of realizing grand conceptual structures.” </p>
</blockquote>
<p>― Frederick P. Brooks, "The Mythical Man Month", 1975</p>
<p>Cascade assists the developer in creating and maintaining data structures in application memory that typically consist of a view model, models, collections of models and possibly other types with references between them.</p>
<p>Cascade defines methods and attributes for maintaining model or IEnumerable&lt;model&gt; reference properties, known as "associations".</p>
<p>In database Entity Relationship Diagrams, relationships between records are normally one-to-one, one-to-many or many-to-one. These three kinds of relationships are all implemented by a foreign key id referencing the id of another table. A one-to-many is the other side of a many-to-one. A fourth kind of relationship - many-to-many is really an intermediate table with two many-to-one relationships. Therefore, all of these kinds of relationships are implemented by :</p>
<ol type="1">
<li>foreign keys referencing other models by their primary key and type, and the ability to retrieve the referenced model</li>
<li>the ability to retrieve all models of a foreign type that reference a local model by its id and type</li>
</ol>
<p>Cascade provides the following attributes for declaring associations on Cascade models. The name associations and the naming of each association type comes from <a href="https://edgeguides.rubyonrails.org/association_basics.html">Ruby On Rails</a></p>
<p>In all cases, Cascade associations are declared by adding a typical property named and typed to represent what value it would have, and adding one of the following C# attributes. This property should not be serialized or deserialized, and is not by the builtin serializer. The attribute may refer to local or foreign keys, such as BelongsTo naming the local property that holds the id of the foreign record that the local instance "belongs to".</p>
<h1><a class="anchor" id="autotoc_md6"></a>
BelongsTo</h1>
<p>A DocketItem "belongs to" a single Docket, and the DocketItem has :</p>
<ol type="1">
<li>a foreign key property of the same type as the Docket id to reference the Docket.</li>
<li>a foreign association reference property of the Docket Type, and the BelongsTo attribute specifying the idProperty as the foreign key property by name.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>DocketItem : SuperModel {</div>
<div class="line">        </div>
<div class="line">    [CascadeId]</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span> <span class="keywordtype">id</span> {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _id); </div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _id, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> _id;</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span> docketId {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _docketId); </div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _docketId, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> _docketId;</div>
<div class="line"> </div>
<div class="line">    [BelongsTo(idProperty: nameof(docketId))]</div>
<div class="line">    public Docket Docket {</div>
<div class="line">        get =&gt; GetProperty(ref _Docket); </div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _Docket, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> Docket _Docket;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
HasMany</h1>
<p>A Docket "has many" DocketItems, and the Docket has:</p>
<ol type="1">
<li>a collection property of ImmutableArray&lt;DocketItem&gt; type to hold the associated DocketItems.</li>
<li>a HasMany attribute on the collection property specifying the foreignIdProperty as the foreign key property on the DocketItem by name.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>Docket : SuperModel</div>
<div class="line">{</div>
<div class="line">    [CascadeId]</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span> <span class="keywordtype">id</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _id);</div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _id, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> _id;</div>
<div class="line"> </div>
<div class="line">    [HasMany(foreignIdProperty: nameof(DocketItem.docketId))]</div>
<div class="line">    public ImmutableArray&lt;DocketItem&gt; Items</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _Items);</div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _Items, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> ImmutableArray&lt;DocketItem&gt; _Items;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this example, the <code>Docket</code> class has a collection of <code>DocketItem</code> objects. The <code>HasMany</code> attribute is applied to the <code>Items</code> property, indicating that a <code>Docket</code> can have multiple <code>DocketItem</code> instances associated with it. The <code>foreignIdProperty</code> parameter in the <code>HasMany</code> attribute specifies that the <code>docketId</code> property in the <code>DocketItem</code> class is used as the foreign key to establish this relationship.</p>
<p>The <code>ImmutableArray&lt;DocketItem&gt;</code> type is used for the collection to ensure thread-safety and to prevent accidental modifications of the collection itself. The actual management of this collection (adding, removing items) is handled by Cascade based on the relationship defined by the <code>HasMany</code> attribute.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
HasOne</h1>
<p>A DocketItem "has one" DocketReceiptItem, and the DocketItem has:</p>
<ol type="1">
<li>a reference property of DocketReceiptItem type to hold the associated DocketReceiptItem.</li>
<li>a HasOne attribute on the reference property specifying the foreignIdProperty as the foreign key property on the DocketReceiptItem by name.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>DocketItem : SuperModel</div>
<div class="line">{</div>
<div class="line">    [CascadeId]</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span> <span class="keywordtype">id</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _id);</div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _id, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> _id;</div>
<div class="line"> </div>
<div class="line">    [HasOne(foreignIdProperty: nameof(DocketReceiptItem.docketItemId))]</div>
<div class="line">    public DocketReceiptItem DocketReceiptItem</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">get</span> =&gt; GetProperty(ref _DocketReceiptItem);</div>
<div class="line">        <span class="keyword">set</span> =&gt; SetProperty(ref _DocketReceiptItem, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> DocketReceiptItem _DocketReceiptItem;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this example, the <code>DocketItem</code> class has a reference to a single <code>DocketReceiptItem</code> object. The <code>HasOne</code> attribute is applied to the <code>DocketReceiptItem</code> property, indicating that a <code>DocketItem</code> can have one associated <code>DocketReceiptItem</code> instance. The <code>foreignIdProperty</code> parameter in the <code>HasOne</code> attribute specifies that the <code>docketItemId</code> property in the <code>DocketReceiptItem</code> class is used as the foreign key to establish this relationship.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
FromBlob</h1>
<p>A ThingPhoto has properties :</p>
<ol type="1">
<li>imagePath - a normal string data property which is a relative storage path as used by BlobGet/BlobPut.</li>
<li>Image - an association property with the FromBlob attribute referencing imagePath and specifying DotNetBitmapConverter.</li>
</ol>
<p>Populating the Image property will internally call BlobGet with imagePath, then the result will be converted to a Bitmap by DotNetBitmapConverter and used to set Image.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ThingPhoto : SuperModel</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">string</span>? imagePath {</div>
<div class="line">      <span class="keyword">get</span> =&gt; GetProperty(ref _ImagePath); </div>
<div class="line">      <span class="keyword">set</span> =&gt; SetProperty(ref _ImagePath, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span>? _ImagePath;</div>
<div class="line">    </div>
<div class="line">    [FromBlob(nameof(imagePath),typeof(DotNetBitmapConverter))]</div>
<div class="line">    <span class="keyword">public</span> Bitmap? Image {</div>
<div class="line">      <span class="keyword">get</span> =&gt; GetProperty(ref _Image); </div>
<div class="line">      <span class="keyword">set</span> =&gt; SetProperty(ref _Image, value);</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">private</span> Bitmap? _Image;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
