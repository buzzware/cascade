<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cascade: Blobs In Depth</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Cascade
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('blobs_in_depth.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Blobs In Depth</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md21"></a>
Why ETags</h2>
<p>An <a href="https://en.wikipedia.org/wiki/HTTP_ETag">Etag</a> is a hash or "fingerprint" of the binary content of a file, and is normally used for comparison of two versions of a file to determine whether they are the same without comparing every byte. This can avoid unnecessary transfers of files that have already been transferred, and enable efficient comparison of large files.</p>
<p>The Cascade "freshness" method reduces server requests by using cached values when the time since the last request is less than the "freshness" seconds. Ths means there will still be server requests when serverside values have not changed, which is hard or possible to avoid, and isn't normally a great cost considering the reduction achieved by caching. However it is different for blobs because they can be of a very large size. ETags provide an effective method to eliminate repeat binary downloads of the same file content.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Using ETags to reduce binary downloads from cache</h2>
<p>Once implemented correctly, ETags are invisible to Cascade application code except for the performance increase in avoiding repeat downloads of the same binary content.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Supporting ETags</h2>
<p>The sequence for ETag support in Cascade goes like this :</p>
<ol type="1">
<li>The application calls BlobGet which creates a RequestOp</li>
<li>Cascade passes the RequestOp to the origin</li>
<li>The origin passes the request to the blob server eg. Azure storage <br  />
</li>
<li>Blob server returns the binary data and the OpResponse.ETag to Cascade</li>
<li>Cascade stores the blob binary and ETag in the cache</li>
<li>The application calls BlobGet again with the same path and 0 freshness</li>
<li>Cascade finds the cache version of the blob and its ETag</li>
<li>Cascade copies the cached ETag into the new RequestOp.Etag</li>
<li>Cascade passes the RequestOp to the Origin</li>
<li>The origin passes the request with the ETag to the blob server</li>
<li>If ETag matches the ETag calculated for the current blob content, a special code eg. HTTP 304 Not Modified is returned and not the binary content.</li>
<li>The origin returns a OpResponse with the ETag and Result = null</li>
<li>Cascade tests whether returned ETag matches the ETag from the cache, and if so, the cached value is returned and then the cached time of arrival is updated to the response time</li>
</ol>
<p>For ETags to work :</p>
<p>1) the blob cache must store and return OpResponse.ETag (FileBlobCache does) 2) the ICascadeOrigin implementation must pass RequestOp.ETag to the blob server, and return the ETag from the blob server in OpResponse.ETag correctly </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
